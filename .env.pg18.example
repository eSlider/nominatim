# Nominatim PG18 profile configuration
# Copy to .env.pg18: cp .env.pg18.example .env.pg18

# Image built by bin/build-pg18-image.sh
NOMINATIM_PG18_IMAGE=nominatim:5.2-pg18

# API port for PG18 profile (keep separate from PG16 profile)
NOMINATIM_PORT=8081

# Path inside container (bind-mounted from ./var-pg18/osm/)
PBF_PATH=/nominatim/data/planet-latest.osm.pbf

# Replication
REPLICATION_URL=https://ftp5.gwdg.de/pub/misc/openstreetmap/planet.openstreetmap.org/replication/day/
REPLICATION_UPDATE_INTERVAL=86400
REPLICATION_RECHECK_INTERVAL=900
UPDATE_MODE=none

# Import options
IMPORT_STYLE=full
IMPORT_WIKIPEDIA=true
IMPORT_US_POSTCODES=true
IMPORT_GB_POSTCODES=true
FREEZE=false
REVERSE_ONLY=false
WARMUP_ON_STARTUP=true

# Runtime tuning
# THREADS maps to osm2pgsql --number-processes (set to `nproc` for all CPUs)
THREADS=20
GUNICORN_WORKERS=14

# PostgreSQL tuning (64 GB RAM baseline)
POSTGRES_SHARED_BUFFERS=16GB
POSTGRES_EFFECTIVE_CACHE_SIZE=48GB
POSTGRES_MAINTENANCE_WORK_MEM=10GB
POSTGRES_AUTOVACUUM_WORK_MEM=2GB
POSTGRES_WORK_MEM=50MB
POSTGRES_SYNCHRONOUS_COMMIT=off
POSTGRES_MAX_WAL_SIZE=2GB
POSTGRES_CHECKPOINT_TIMEOUT=15min
POSTGRES_CHECKPOINT_COMPLETION_TARGET=0.9
POSTGRES_MAX_CONNECTIONS=200

# Docker runtime knobs
NOMINATIM_SHM_SIZE=32g
NOMINATIM_NOFILE=1048576
NOMINATIM_STOP_GRACE_PERIOD=2m

# Security
NOMINATIM_PASSWORD=changeme
